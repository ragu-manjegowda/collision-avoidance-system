<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>collisionAvoidanceSystem • collisionAvoidanceSystem</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="collisionAvoidanceSystem">
<meta property="og:description" content="Collision Avoidance System that can estimate time to collision by fusing lidar and camera data">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">collisionAvoidanceSystem</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ragu-manjegowda/collision-avoidance-system/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="collision-avoidance-system" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#collision-avoidance-system" class="anchor"></a>Collision Avoidance System</h1></div>
<p>Design of a collision avoidance system by fusing data from lidar and camera. Camera and Lidar sensor data is taken from KITTI dataset.</p>
<p><img src="reference/figures/collisionAvoidanceSystem.gif" width="900" height="350"></p>
<div id="high-level-architecture" class="section level2">
<h2 class="hasAnchor">
<a href="#high-level-architecture" class="anchor"></a>High level architecture</h2>
<p><img src="reference/figures/collisionAvoidanceSystem.png"></p>
<p>Objective of the project is to estimate time to collision based on the inputs from camera and lidar sensors.</p>
<p>Following are the four major tasks to do this:</p>
</div>
<div id="object-classification" class="section level2">
<h2 class="hasAnchor">
<a href="#object-classification" class="anchor"></a>Object classification</h2>
<p><img src="reference/figures/objectClassification.png" width="900" height="350"></p>
<p>Object detection and classification is out of the scope of this project, for sake of simplicity quick and simple off-the-shelf deep learning based object detection and classification framework <a href="https://www.youtube.com/watch?v=NM6lrxy0bxs">YOLO</a>.</p>
<p>All the images from camera sensor is fed in to YOLO framework to obtain bounding boxes as shown in the image.</p>
</div>
<div id="crop-lidar-points" class="section level2">
<h2 class="hasAnchor">
<a href="#crop-lidar-points" class="anchor"></a>Crop Lidar points</h2>
<div id="top-view-perspective-of-lidar-points" class="section level3">
<h3 class="hasAnchor">
<a href="#top-view-perspective-of-lidar-points" class="anchor"></a>Top view perspective of Lidar points</h3>
<p><img src="reference/figures/lidarToCamera.png" width="900" height="350"></p>
<ol>
<li><p>Points cloud received from Lidar sensor (10 Hz) is cropped to focus on ego lane</p></li>
<li>Later lidar points are transformed from lidar co-ordinate system to Homogeneous co-ordinate system.</li>
<li><p>Points in homogeneous system and projected to camera plane using calibration matrices (Provided by KITTI)</p></li>
</ol>
<pre><code>// assemble vector for matrix-vector-multiplication
X.at&lt;double&gt;(0, 0) = it1-&gt;x;
X.at&lt;double&gt;(1, 0) = it1-&gt;y;
X.at&lt;double&gt;(2, 0) = it1-&gt;z;
X.at&lt;double&gt;(3, 0) = 1;

// project Lidar point into camera
Y = P_rect_xx * R_rect_xx * RT * X;
cv::Point pt;
pt.x = Y.at&lt;double&gt;(0, 0) / Y.at&lt;double&gt;(0, 2);  // pixel coordinates
pt.y = Y.at&lt;double&gt;(1, 0) / Y.at&lt;double&gt;(0, 2);</code></pre>
<ol>
<li>Lidar Points in image plane that lies within bounding boxes are stored within the data structure boundingBox and the rest are filtered out. Points in each bounding box is shriked by the given percentage to avoid 3D object merging at the edges of an ROI</li>
</ol>
<p><img src="reference/figures/lidarToCameraProcessedTopView.png" width="700" height="700"></p>
</div>
</div>
<div id="keypoints-detection-and-their-correspondences" class="section level2">
<h2 class="hasAnchor">
<a href="#keypoints-detection-and-their-correspondences" class="anchor"></a>Keypoints detection and their correspondences</h2>
<p><img src="reference/figures/keypointsMatching.png" width="900" height="350"></p>
<p>By analyzing and comparing classic computer vision concepts HARRIS corner detection, SHITHOMASI against modern algorithms like FAST, SIFT, BRISK etc.., a robust mechanis is developed that can detect keypoints and generate descriptors.</p>
<p>Descriptors from two images (current and previous) are then matched using suitable macthing (Brute Force or FLANN) and selector types (Nearest Neightbour or K-Nearest Neighbour).</p>
<p>Following are the different detectors, descriptors algorithms supported and compared in the project for speed and accuracy.</p>
<pre><code>enum class DetectorTypeIndex
{
    FAST = 0,
    BRISK = 1,
    ORB = 2,
    AKAZE = 3,
    SIFT = 4,
    SHITOMASI = 5,
    HARRIS = 6
};

enum class DescriptorTypeIndex
{
    BRISK = 0,
    BRIEF = 1,
    ORB = 2,
    FREAK = 3,
    AKAZE = 4,
    SIFT = 5,
};</code></pre>
<p>Detailed information about comparions between different detectors and descriptors can be found here,</p>
<p><a href="https://docs.google.com/spreadsheets/d/1m-ptLTKXCUn8nhX25oxF452m0p5xW5rIebDYBdNSZgU/edit?usp=sharing">DetectorDescriptorAnalysis</a></p>
</div>
<div id="match-bounding-boxes-between-two-frames" class="section level2">
<h2 class="hasAnchor">
<a href="#match-bounding-boxes-between-two-frames" class="anchor"></a>Match bounding boxes between two frames</h2>
<p>Based on the matched keypoints, bounding boxes between teo consecutive images are compared and thier indices are matched based on the keypoint information.</p>
</div>
<div id="calculating-ttc-time-to-collision" class="section level2">
<h2 class="hasAnchor">
<a href="#calculating-ttc-time-to-collision" class="anchor"></a>Calculating TTC (Time to Collision)</h2>
<p>Based on the matched bounding box information time to collision is calculated separately using lidar and camera data.</p>
<div id="using-lidar-data" class="section level3">
<h3 class="hasAnchor">
<a href="#using-lidar-data" class="anchor"></a>Using Lidar data</h3>
<p>Implemented the estimation in a way that makes it robust against outliers which might be way too close and thus lead to faulty estimates of the TTC. For the lidar points that was processed earlier, time to collision is calculated by calculating the median of the lidar points along x axis (driving direction).</p>
</div>
<div id="using-camera-data" class="section level3">
<h3 class="hasAnchor">
<a href="#using-camera-data" class="anchor"></a>Using Camera data</h3>
<ol>
<li>All the matched keypoints between current and previous images are iterated and distance between them is calculated, then median of those distances is calculated.</li>
<li>All the points that are of distance greater then <code>maxDistanceFromMedian</code> are filtered to remove the outliers.</li>
<li>A reliable TTC estimate with the median of all relative distance ratios​ between previous and current images.</li>
</ol>
</div>
</div>
<div id="display-the-computer-ttc" class="section level2">
<h2 class="hasAnchor">
<a href="#display-the-computer-ttc" class="anchor"></a>Display the computer TTC</h2>
<p>In the final non-technical part, calculated TTC information from lidar and camera is rendered using <code>cv::imshow</code>, bounding box is rendered in red if the TTC is less than 7 seconds.</p>
</div>
<div id="dependencies-for-running-locally" class="section level2">
<h2 class="hasAnchor">
<a href="#dependencies-for-running-locally" class="anchor"></a>Dependencies for Running Locally</h2>
<div id="using-docker" class="section level3">
<h3 class="hasAnchor">
<a href="#using-docker" class="anchor"></a>Using docker</h3>
<pre><code>$ docker pull ragumanjegowda/docker:latest</code></pre>
</div>
<div id="native-i-have-not-tested-this" class="section level3">
<h3 class="hasAnchor">
<a href="#native-i-have-not-tested-this" class="anchor"></a>Native (I have not tested this)</h3>
<ul>
<li>cmake &gt;= 2.8</li>
<li>All OSes: <a href="https://cmake.org/install/">click here for installation instructions</a>
</li>
<li>make &gt;= 4.1 (Linux, Mac), 3.81 (Windows)</li>
<li>Linux: make is installed by default on most Linux distros</li>
<li>Mac: <a href="https://developer.apple.com/xcode/features/">install Xcode command line tools to get make</a>
</li>
<li>Windows: <a href="http://gnuwin32.sourceforge.net/packages/make.htm">Click here for installation instructions</a>
</li>
<li>Git LFS</li>
<li>Weight files are handled using <a href="https://git-lfs.github.com/">LFS</a>
</li>
<li>OpenCV &gt;= 4.1</li>
<li>This must be compiled from source using the <code>-D OPENCV_ENABLE_NONFREE=ON</code> cmake flag for testing the SIFT and SURF detectors.</li>
<li>The OpenCV 4.1.0 source code can be found <a href="https://github.com/opencv/opencv/tree/4.1.0">here</a>
</li>
<li>gcc/g++ &gt;= 5.4</li>
<li>Linux: gcc / g++ is installed by default on most Linux distros</li>
<li>Mac: same deal as make - <a href="https://developer.apple.com/xcode/features/">install Xcode command line tools</a>
</li>
<li>Windows: recommend using <a href="http://www.mingw.org/">MinGW</a>
</li>
</ul>
</div>
</div>
<div id="basic-build-instructions" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-build-instructions" class="anchor"></a>Basic Build Instructions</h2>
<pre><code>$&gt; mkdir build &amp;&amp; cd build
$&gt; cmake -G Ninja ..
$&gt; ninja -j400
$&gt; ./3D_object_tracking</code></pre>
</div>
<div id="credits" class="section level2">
<h2 class="hasAnchor">
<a href="#credits" class="anchor"></a>Credits</h2>
<p>Based on Udacity’s <a href="https://github.com/udacity/SFND_3D_Object_Tracking">SFND_3D_Object_Tracking</a></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/ragu-manjegowda/collision-avoidance-system/">https://​github.com/​ragu-manjegowda/​collision-avoidance-system/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/ragu-manjegowda/collision-avoidance-system/issues">https://​github.com/​ragu-manjegowda/​collision-avoidance-system/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://opensource.org/licenses/mit-license.php">MIT</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Ragu Manjegowda <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Ragu Manjegowda.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
